const f=e=>typeof e=="object"&&typeof e.then=="function",i=[];function l(e,n,r=(s,o)=>s===o){if(e===n)return!0;if(!e||!n)return!1;const s=e.length;if(n.length!==s)return!1;for(let o=0;o<s;o++)if(!r(e[o],n[o]))return!1;return!0}function u(e,n=null,r=!1,s={}){n===null&&(n=[e]);for(const t of i)if(l(n,t.keys,t.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(t,"error"))throw t.error;if(Object.prototype.hasOwnProperty.call(t,"response"))return s.lifespan&&s.lifespan>0&&(t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(t.remove,s.lifespan)),t.response;if(!r)throw t.promise}const o={keys:n,equal:s.equal,remove:()=>{const t=i.indexOf(o);t!==-1&&i.splice(t,1)},promise:(f(e)?e:e(...n)).then(t=>{o.response=t,s.lifespan&&s.lifespan>0&&(o.timeout=setTimeout(o.remove,s.lifespan))}).catch(t=>o.error=t)};if(i.push(o),!r)throw o.promise}const p=(e,n,r)=>u(e,n,!1,r),a=(e,n,r)=>void u(e,n,!0,r),c=e=>{if(e===void 0||e.length===0)i.splice(0,i.length);else{const n=i.find(r=>l(e,r.keys,r.equal));n&&n.remove()}};export{c,a as p,p as s};
