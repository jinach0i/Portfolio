import{_ as ye}from"./@babel-3xQx7WiQ.js";import{r as P}from"./react-eBbB0m8U.js";import{L as we,T as Pt,R as Et,U as Mt,a as Ct,O as Ae,P as Le,S as Be,b as _e,N as St,A as xt,B as Ot,M as Rt,C as Tt,V as Z,c as jt,W as kt,d as At,e as Lt,f as Dt,g as It,h as Ft,i as zt,D as Ht,j as ve}from"./three-XCib9RHR.js";import{u as Bt}from"./react-use-measure-cxrJcbjI.js";import{F as Wt,u as $t}from"./its-fine-M1EgxJJj.js";import{R as Nt,c as ie}from"./react-reconciler-xWoml0bn.js";import{c as qt}from"./react-dom-yKM8Rrfl.js";import{c as Ze}from"./zustand-x_ChMIfy.js";import{O as Gt}from"./three-stdlib-cbnQRwKt.js";import{s as Vt,p as Ut,c as Xt}from"./suspend-react-7rE_FwbT.js";var Ke={exports:{}},Je={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(h,x){var S=h.length;h.push(x);e:for(;0<S;){var T=S-1>>>1,O=h[T];if(0<a(O,x))h[T]=x,h[S]=O,S=T;else break e}}function r(h){return h.length===0?null:h[0]}function i(h){if(h.length===0)return null;var x=h[0],S=h.pop();if(S!==x){h[0]=S;e:for(var T=0,O=h.length,k=O>>>1;T<k;){var $=2*(T+1)-1,I=h[$],G=$+1,U=h[G];if(0>a(I,S))G<O&&0>a(U,I)?(h[T]=U,h[G]=S,T=G):(h[T]=I,h[$]=S,T=$);else if(G<O&&0>a(U,S))h[T]=U,h[G]=S,T=G;else break e}}return x}function a(h,x){var S=h.sortIndex-x.sortIndex;return S!==0?S:h.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;e.unstable_now=function(){return f.now()}}else{var _=Date,v=_.now();e.unstable_now=function(){return _.now()-v}}var s=[],y=[],n=1,o=null,u=3,d=!1,p=!1,M=!1,g=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,c=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(h){for(var x=r(y);x!==null;){if(x.callback===null)i(y);else if(x.startTime<=h)i(y),x.sortIndex=x.expirationTime,t(s,x);else break;x=r(y)}}function C(h){if(M=!1,m(h),!p)if(r(s)!==null)p=!0,N(E);else{var x=r(y);x!==null&&B(C,x.startTime-h)}}function E(h,x){p=!1,M&&(M=!1,l(A),A=-1),d=!0;var S=u;try{for(m(x),o=r(s);o!==null&&(!(o.expirationTime>x)||h&&!b());){var T=o.callback;if(typeof T=="function"){o.callback=null,u=o.priorityLevel;var O=T(o.expirationTime<=x);x=e.unstable_now(),typeof O=="function"?o.callback=O:o===r(s)&&i(s),m(x)}else i(s);o=r(s)}if(o!==null)var k=!0;else{var $=r(y);$!==null&&B(C,$.startTime-x),k=!1}return k}finally{o=null,u=S,d=!1}}var w=!1,j=null,A=-1,R=5,D=-1;function b(){return!(e.unstable_now()-D<R)}function L(){if(j!==null){var h=e.unstable_now();D=h;var x=!0;try{x=j(!0,h)}finally{x?W():(w=!1,j=null)}}else w=!1}var W;if(typeof c=="function")W=function(){c(L)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,H=V.port2;V.port1.onmessage=L,W=function(){H.postMessage(null)}}else W=function(){g(L,0)};function N(h){j=h,w||(w=!0,W())}function B(h,x){A=g(function(){h(e.unstable_now())},x)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(h){h.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,N(E))},e.unstable_forceFrameRate=function(h){0>h||125<h?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<h?Math.floor(1e3/h):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return r(s)},e.unstable_next=function(h){switch(u){case 1:case 2:case 3:var x=3;break;default:x=u}var S=u;u=x;try{return h()}finally{u=S}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(h,x){switch(h){case 1:case 2:case 3:case 4:case 5:break;default:h=3}var S=u;u=h;try{return x()}finally{u=S}},e.unstable_scheduleCallback=function(h,x,S){var T=e.unstable_now();switch(typeof S=="object"&&S!==null?(S=S.delay,S=typeof S=="number"&&0<S?T+S:T):S=T,h){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=S+O,h={id:n++,callback:x,priorityLevel:h,startTime:S,expirationTime:O,sortIndex:-1},S>T?(h.sortIndex=S,t(y,h),r(s)===null&&h===r(y)&&(M?(l(A),A=-1):M=!0,B(C,S-T))):(h.sortIndex=O,t(s,h),p||d||(p=!0,N(E))),h},e.unstable_shouldYield=b,e.unstable_wrapCallback=function(h){var x=u;return function(){var S=u;u=x;try{return h.apply(this,arguments)}finally{u=S}}}})(Je);Ke.exports=Je;var We=Ke.exports;const De={},Yt=e=>void Object.assign(De,e);function Zt(e,t){function r(n,{args:o=[],attach:u,...d},p){let M=`${n[0].toUpperCase()}${n.slice(1)}`,g;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;g=re(l,{type:n,root:p,attach:u,primitive:!0})}else{const l=De[M];if(!l)throw new Error(`R3F: ${M} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");g=re(new l(...o),{type:n,root:p,attach:u,memoizedProps:{args:o}})}return g.__r3f.attach===void 0&&(g instanceof Ot?g.__r3f.attach="geometry":g instanceof Rt&&(g.__r3f.attach="material")),M!=="inject"&&Me(g,d),g}function i(n,o){let u=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Ee(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),u=!0),u||(p=n.__r3f)==null||p.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=n,je(o),oe(o)}}function a(n,o,u){let d=!1;if(o){var p,M;if((p=o.__r3f)!=null&&p.attach)Ee(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const g=n.children.filter(c=>c!==o),l=g.indexOf(u);n.children=[...g.slice(0,l),o,...g.slice(l)],d=!0}d||(M=n.__r3f)==null||M.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=n,je(o),oe(o)}}function f(n,o,u=!1){n&&[...n].forEach(d=>_(o,d,u))}function _(n,o,u){if(o){var d,p,M;if(o.__r3f&&(o.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(C=>C!==o)),(p=o.__r3f)!=null&&p.attach)Ve(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var g;n.remove(o),(g=o.__r3f)!=null&&g.root&&sn(o.__r3f.root,o)}const c=(M=o.__r3f)==null?void 0:M.primitive,m=!c&&(u===void 0?o.dispose!==null:u);if(!c){var l;f((l=o.__r3f)==null?void 0:l.objects,o,m),f(o.children,o,m)}if(delete o.__r3f,m&&o.dispose&&o.type!=="Scene"){const C=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?We.unstable_scheduleCallback(We.unstable_IdlePriority,C):C()}oe(n)}}function v(n,o,u,d){var p;const M=(p=n.__r3f)==null?void 0:p.parent;if(!M)return;const g=r(o,u,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(g,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(g,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||_(M,n),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),i(M,g),g.raycast&&g.__r3f.eventCount&&g.__r3f.root.getState().internal.interaction.push(g),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=g,l.ref&&(typeof l.ref=="function"?l.ref(g):l.ref.current=g))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Nt({createInstance:r,removeChild:_,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const u=n.getState().scene;u.__r3f&&(u.__r3f.root=n,i(u,o))},removeChildFromContainer:(n,o)=>{o&&_(n.getState().scene,o)},insertInContainerBefore:(n,o,u)=>{if(!o||!u)return;const d=n.getState().scene;d.__r3f&&a(d,o,u)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,u,d){var p;if(((p=n==null?void 0:n.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==n)return[!0];{const{args:g=[],children:l,...c}=d,{args:m=[],children:C,...E}=u;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((j,A)=>j!==m[A]))return[!0];const w=it(n,c,E,!0);return w.changes.length?[!1,w]:null}},commitUpdate(n,[o,u],d,p,M,g){o?v(n,d,M,g):Me(n,u)},commitMount(n,o,u,d){var p;const M=(p=n.__r3f)!=null?p:{};n.raycast&&M.handlers&&M.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>re(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:u,parent:d}=(o=n.__r3f)!=null?o:{};u&&d&&Ve(d,n,u),n.isObject3D&&(n.visible=!1),oe(n)},unhideInstance(n,o){var u;const{attach:d,parent:p}=(u=n.__r3f)!=null?u:{};d&&p&&Ee(p,n,d),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),oe(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():ie.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&z.fun(performance.now)?performance.now:z.fun(Date.now)?Date.now:()=>0,scheduleTimeout:z.fun(setTimeout)?setTimeout:void 0,cancelTimeout:z.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Me}}var $e,Ne;const Pe=e=>"colorSpace"in e||"outputColorSpace"in e,Qe=()=>{var e;return(e=De.ColorManagement)!=null?e:null},et=e=>e&&e.isOrthographicCamera,Kt=e=>e&&e.hasOwnProperty("current"),fe=typeof window<"u"&&(($e=window.document)!=null&&$e.createElement||((Ne=window.navigator)==null?void 0:Ne.product)==="ReactNative")?P.useLayoutEffect:P.useEffect;function tt(e){const t=P.useRef(e);return fe(()=>void(t.current=e),[e]),t}function Jt({set:e}){return fe(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class nt extends P.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}nt.getDerivedStateFromError=()=>({error:!0});const rt="__default",qe=new Map,Qt=e=>e&&!!e.memoized&&!!e.changes;function ot(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const le=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},z={obj:e=>e===Object(e)&&!z.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(z.str(e)||z.num(e))return e===t;const f=z.obj(e);if(f&&i==="reference")return e===t;const _=z.arr(e);if(_&&r==="reference")return e===t;if((_||f)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(f&&r==="shallow"&&i==="shallow"){for(v in a?t:e)if(!z.equ(e[v],t[v],{strict:a,objects:"reference"}))return!1}else for(v in a?t:e)if(e[v]!==t[v])return!1;if(z.und(v)){if(_&&e.length===0&&t.length===0||f&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function en(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function tn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function re(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Te(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return r=i.reduce((f,_)=>f[_],e),{target:r,key:a}}else return{target:r,key:t}}const Ge=/-\d+$/;function Ee(e,t,r){if(z.str(r)){if(Ge.test(r)){const f=r.replace(Ge,""),{target:_,key:v}=Te(e,f);Array.isArray(_[v])||(_[v]=[])}const{target:i,key:a}=Te(e,r);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=r(e,t)}function Ve(e,t,r){var i,a;if(z.str(r)){const{target:f,key:_}=Te(e,r),v=t.__r3f.previousAttach;v===void 0?delete f[_]:f[_]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function it(e,{children:t,key:r,ref:i,...a},{children:f,key:_,ref:v,...s}={},y=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},u=Object.entries(a),d=[];if(y){const M=Object.keys(s);for(let g=0;g<M.length;g++)a.hasOwnProperty(M[g])||u.unshift([M[g],rt+"remove"])}u.forEach(([M,g])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&M==="object"||z.equ(g,s[M]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(M))return d.push([M,g,!0,[]]);let c=[];M.includes("-")&&(c=M.split("-")),d.push([M,g,!1,c]);for(const m in a){const C=a[m];m.startsWith(`${M}-`)&&d.push([m,C,!1,m.split("-")])}});const p={...a};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}const nn=typeof process<"u"&&!1;function Me(e,t){var r,i,a;const f=(r=e.__r3f)!=null?r:{},_=f.root,v=(i=_==null||_.getState==null?void 0:_.getState())!=null?i:{},{memoized:s,changes:y}=Qt(t)?t:it(e,t),n=f.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let u=0;u<y.length;u++){let[d,p,M,g]=y[u];if(Pe(e)){const C="srgb",E="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?C:E):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?C:E)}let l=e,c=l[d];if(g.length&&(c=g.reduce((m,C)=>m[C],e),!(c&&c.set))){const[m,...C]=g.reverse();l=C.reverse().reduce((E,w)=>E[w],e),d=m}if(p===rt+"remove")if(l.constructor){let m=qe.get(l.constructor);m||(m=new l.constructor,qe.set(l.constructor,m)),p=m[d]}else p=0;if(M)p?f.handlers[d]=p:delete f.handlers[d],f.eventCount=Object.keys(f.handlers).length;else if(c&&c.set&&(c.copy||c instanceof we)){if(Array.isArray(p))c.fromArray?c.fromArray(p):c.set(...p);else if(c.copy&&p&&p.constructor&&(nn?c.constructor.name===p.constructor.name:c.constructor===p.constructor))c.copy(p);else if(p!==void 0){const m=c instanceof Tt;!m&&c.setScalar?c.setScalar(p):c instanceof we&&p instanceof we?c.mask=p.mask:c.set(p),!Qe()&&!v.linear&&m&&c.convertSRGBToLinear()}}else if(l[d]=p,l[d]instanceof Pt&&l[d].format===Et&&l[d].type===Mt){const m=l[d];Pe(m)&&Pe(v.gl)?m.colorSpace=v.gl.outputColorSpace:m.encoding=v.gl.outputEncoding}oe(e)}if(f.parent&&v.internal&&e.raycast&&n!==f.eventCount){const u=v.internal.interaction.indexOf(e);u>-1&&v.internal.interaction.splice(u,1),f.eventCount&&v.internal.interaction.push(e)}return!(y.length===1&&y[0][0]==="onUpdate")&&y.length&&(a=e.__r3f)!=null&&a.parent&&je(e),e}function oe(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function je(e){e.onUpdate==null||e.onUpdate(e)}function rn(e,t){e.manual||(et(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function me(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function on(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ie.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}}function st(e,t,r,i){const a=r.get(t);a&&(r.delete(t),r.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function sn(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(a)}),r.capturedMap.forEach((i,a)=>{st(r.capturedMap,t,i,a)})}function an(e){function t(s){const{internal:y}=e.getState(),n=s.offsetX-y.initialClick[0],o=s.offsetY-y.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(s){return s.filter(y=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=y.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(s,y){const n=e.getState(),o=new Set,u=[],d=y?y(n.internal.interaction):n.internal.interaction;for(let l=0;l<d.length;l++){const c=le(d[l]);c&&(c.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function p(l){const c=le(l);if(!c||!c.events.enabled||c.raycaster.camera===null)return[];if(c.raycaster.camera===void 0){var m;c.events.compute==null||c.events.compute(s,c,(m=c.previousRoot)==null?void 0:m.getState()),c.raycaster.camera===void 0&&(c.raycaster.camera=null)}return c.raycaster.camera?c.raycaster.intersectObject(l,!0):[]}let M=d.flatMap(p).sort((l,c)=>{const m=le(l.object),C=le(c.object);return!m||!C?l.distance-c.distance:C.events.priority-m.events.priority||l.distance-c.distance}).filter(l=>{const c=me(l);return o.has(c)?!1:(o.add(c),!0)});n.events.filter&&(M=n.events.filter(M,n));for(const l of M){let c=l.object;for(;c;){var g;(g=c.__r3f)!=null&&g.eventCount&&u.push({...l,eventObject:c}),c=c.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let l of n.internal.capturedMap.get(s.pointerId).values())o.has(me(l.intersection))||u.push(l.intersection);return u}function a(s,y,n,o){const u=e.getState();if(s.length){const d={stopped:!1};for(const p of s){const M=le(p.object)||u,{raycaster:g,pointer:l,camera:c,internal:m}=M,C=new Z(l.x,l.y,0).unproject(c),E=D=>{var b,L;return(b=(L=m.capturedMap.get(D))==null?void 0:L.has(p.eventObject))!=null?b:!1},w=D=>{const b={intersection:p,target:y.target};m.capturedMap.has(D)?m.capturedMap.get(D).set(p.eventObject,b):m.capturedMap.set(D,new Map([[p.eventObject,b]])),y.target.setPointerCapture(D)},j=D=>{const b=m.capturedMap.get(D);b&&st(m.capturedMap,p.eventObject,b,D)};let A={};for(let D in y){let b=y[D];typeof b!="function"&&(A[D]=b)}let R={...p,...A,pointer:l,intersections:s,stopped:d.stopped,delta:n,unprojectedPoint:C,ray:g.ray,camera:c,stopPropagation(){const D="pointerId"in y&&m.capturedMap.get(y.pointerId);if((!D||D.has(p.eventObject))&&(R.stopped=d.stopped=!0,m.hovered.size&&Array.from(m.hovered.values()).find(b=>b.eventObject===p.eventObject))){const b=s.slice(0,s.indexOf(p));f([...b,p])}},target:{hasPointerCapture:E,setPointerCapture:w,releasePointerCapture:j},currentTarget:{hasPointerCapture:E,setPointerCapture:w,releasePointerCapture:j},nativeEvent:y};if(o(R),d.stopped===!0)break}}return s}function f(s){const{internal:y}=e.getState();for(const n of y.hovered.values())if(!s.length||!s.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const u=n.eventObject.__r3f,d=u==null?void 0:u.handlers;if(y.hovered.delete(me(n)),u!=null&&u.eventCount){const p={...n,intersections:s};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function _(s,y){for(let n=0;n<y.length;n++){const o=y[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(s)}}function v(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>f([]);case"onLostPointerCapture":return y=>{const{internal:n}=e.getState();"pointerId"in y&&n.capturedMap.has(y.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(y.pointerId)&&(n.capturedMap.delete(y.pointerId),f([]))})}}return function(n){const{onPointerMissed:o,internal:u}=e.getState();u.lastEvent.current=n;const d=s==="onPointerMove",p=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",g=i(n,d?r:void 0),l=p?t(n):0;s==="onPointerDown"&&(u.initialClick=[n.offsetX,n.offsetY],u.initialHits=g.map(m=>m.eventObject)),p&&!g.length&&l<=2&&(_(n,u.interaction),o&&o(n)),d&&f(g);function c(m){const C=m.eventObject,E=C.__r3f,w=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(d){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const j=me(m),A=u.hovered.get(j);A?A.stopped&&m.stopPropagation():(u.hovered.set(j,m),w.onPointerOver==null||w.onPointerOver(m),w.onPointerEnter==null||w.onPointerEnter(m))}w.onPointerMove==null||w.onPointerMove(m)}else{const j=w[s];j?(!p||u.initialHits.includes(C))&&(_(n,u.interaction.filter(A=>!u.initialHits.includes(A))),j(m)):p&&u.initialHits.includes(C)&&_(n,u.interaction.filter(A=>!u.initialHits.includes(A)))}}a(g,n,l,c)}}return{handlePointer:v}}const at=e=>!!(e!=null&&e.render),lt=P.createContext(null),ln=(e,t)=>{const r=Ze((v,s)=>{const y=new Z,n=new Z,o=new Z;function u(l=s().camera,c=n,m=s().size){const{width:C,height:E,top:w,left:j}=m,A=C/E;c instanceof Z?o.copy(c):o.set(...c);const R=l.getWorldPosition(y).distanceTo(o);if(et(l))return{width:C/l.zoom,height:E/l.zoom,top:w,left:j,factor:1,distance:R,aspect:A};{const D=l.fov*Math.PI/180,b=2*Math.tan(D/2)*R,L=b*(C/E);return{width:L,height:b,top:w,left:j,factor:C/L,distance:R,aspect:A}}}let d;const p=l=>v(c=>({performance:{...c.performance,current:l}})),M=new jt;return{set:v,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(s(),l),advance:(l,c)=>t(l,c,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Ft,pointer:M,mouse:M,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=s();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(s().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:l=>v(c=>({...c,events:{...c.events,...l}})),setSize:(l,c,m,C,E)=>{const w=s().camera,j={width:l,height:c,top:C||0,left:E||0,updateStyle:m};v(A=>({size:j,viewport:{...A.viewport,...u(w,n,j)}}))},setDpr:l=>v(c=>{const m=ot(l);return{viewport:{...c.viewport,dpr:m,initialDpr:c.viewport.initialDpr||m}}}),setFrameloop:(l="always")=>{const c=s().clock;c.stop(),c.elapsedTime=0,l!=="never"&&(c.start(),c.elapsedTime=0),v(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:P.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,c,m)=>{const C=s().internal;return C.priority=C.priority+(c>0?1:0),C.subscribers.push({ref:l,priority:c,store:m}),C.subscribers=C.subscribers.sort((E,w)=>E.priority-w.priority),()=>{const E=s().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(c>0?1:0),E.subscribers=E.subscribers.filter(w=>w.ref!==l))}}}}}),i=r.getState();let a=i.size,f=i.viewport.dpr,_=i.camera;return r.subscribe(()=>{const{camera:v,size:s,viewport:y,gl:n,set:o}=r.getState();if(s.width!==a.width||s.height!==a.height||y.dpr!==f){var u;a=s,f=y.dpr,rn(v,s),n.setPixelRatio(y.dpr);const d=(u=s.updateStyle)!=null?u:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,d)}v!==_&&(_=v,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let he,cn=new Set,un=new Set,fn=new Set;function Ce(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function ce(e,t){switch(e){case"before":return Ce(cn,t);case"after":return Ce(un,t);case"tail":return Ce(fn,t)}}let Se,xe;function Oe(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Se=t.internal.subscribers,he=0;he<Se.length;he++)xe=Se[he],xe.ref.current(xe.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function dn(e){let t=!1,r,i,a;function f(s){i=requestAnimationFrame(f),t=!0,r=0,ce("before",s);for(const n of e.values()){var y;a=n.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((y=a.gl.xr)!=null&&y.isPresenting)&&(r+=Oe(s,a))}if(ce("after",s),r===0)return ce("tail",s),t=!1,cancelAnimationFrame(i)}function _(s,y=1){var n;if(!s)return e.forEach(o=>_(o.store.getState()),y);(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+y),t||(t=!0,requestAnimationFrame(f)))}function v(s,y=!0,n,o){if(y&&ce("before",s),n)Oe(s,n,o);else for(const u of e.values())Oe(s,u.store.getState());y&&ce("after",s)}return{loop:f,invalidate:_,advance:v}}function ct(){const e=P.useContext(lt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Y(e=r=>r,t){return ct()(e,t)}function ut(e,t=0){const r=ct(),i=r.getState().internal.subscribe,a=tt(e);return fe(()=>i(a,t,r),[t,i,r]),null}const Ue=new WeakMap;function ft(e,t){return function(r,...i){let a=Ue.get(r);return a||(a=new r,Ue.set(r,a)),e&&e(a),Promise.all(i.map(f=>new Promise((_,v)=>a.load(f,s=>{s.scene&&Object.assign(s,en(s.scene)),_(s)},t,s=>v(new Error(`Could not load ${f}: ${s==null?void 0:s.message}`)))))).finally(()=>a.dispose==null?void 0:a.dispose())}}function dt(e,t,r,i){const a=Array.isArray(t)?t:[t],f=Vt(ft(r,i),[e,...a],{equal:z.equ});return Array.isArray(t)?f:f[0]}dt.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return Ut(ft(r),[e,...i])};dt.clear=function(e,t){const r=Array.isArray(t)?t:[t];return Xt([e,...r])};const se=new Map,{invalidate:Xe,advance:Ye}=dn(se),{reconciler:ge,applyProps:te}=Zt(se,on),ne={objects:"shallow",strict:!1},pn=(e,t)=>{const r=typeof e=="function"?e(t):e;return at(r)?r:new kt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function vn(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:a,top:f,left:_,updateStyle:v=r}=t;return{width:i,height:a,top:f,left:_,updateStyle:v}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:a,top:f,left:_}=e.parentElement.getBoundingClientRect();return{width:i,height:a,top:f,left:_,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function mn(e){const t=se.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,f=i||ln(Xe,Ye),_=r||ge.createContainer(f,ie.ConcurrentRoot,null,!1,null,"",a,null);t||se.set(e,{fiber:_,store:f});let v,s=!1,y;return{configure(n={}){let{gl:o,size:u,scene:d,events:p,onCreated:M,shadows:g=!1,linear:l=!1,flat:c=!1,legacy:m=!1,orthographic:C=!1,frameloop:E="always",dpr:w=[1,2],performance:j,raycaster:A,camera:R,onPointerMissed:D}=n,b=f.getState(),L=b.gl;b.gl||b.set({gl:L=pn(o,e)});let W=b.raycaster;W||b.set({raycaster:W=new Ct});const{params:V,...H}=A||{};if(z.equ(H,W,ne)||te(W,{...H}),z.equ(V,W.params,ne)||te(W,{params:{...W.params,...V}}),!b.camera||b.camera===y&&!z.equ(y,R,ne)){y=R;const O=R instanceof At,k=O?R:C?new Ae(0,0,0,0,.1,1e3):new Le(75,0,.1,1e3);O||(k.position.z=5,R&&te(k,R),!b.camera&&!(R!=null&&R.rotation)&&k.lookAt(0,0,0)),b.set({camera:k}),W.camera=k}if(!b.scene){let O;d instanceof Be?O=d:(O=new Be,d&&te(O,d)),b.set({scene:re(O)})}if(!b.xr){var N;const O=(I,G)=>{const U=f.getState();U.frameloop!=="never"&&Ye(I,!0,U,G)},k=()=>{const I=f.getState();I.gl.xr.enabled=I.gl.xr.isPresenting,I.gl.xr.setAnimationLoop(I.gl.xr.isPresenting?O:null),I.gl.xr.isPresenting||Xe(I)},$={connect(){const I=f.getState().gl;I.xr.addEventListener("sessionstart",k),I.xr.addEventListener("sessionend",k)},disconnect(){const I=f.getState().gl;I.xr.removeEventListener("sessionstart",k),I.xr.removeEventListener("sessionend",k)}};typeof((N=L.xr)==null?void 0:N.addEventListener)=="function"&&$.connect(),b.set({xr:$})}if(L.shadowMap){const O=L.shadowMap.enabled,k=L.shadowMap.type;if(L.shadowMap.enabled=!!g,z.boo(g))L.shadowMap.type=_e;else if(z.str(g)){var B;const $={basic:Lt,percentage:Dt,soft:_e,variance:It};L.shadowMap.type=(B=$[g])!=null?B:_e}else z.obj(g)&&Object.assign(L.shadowMap,g);(O!==L.shadowMap.enabled||k!==L.shadowMap.type)&&(L.shadowMap.needsUpdate=!0)}const h=Qe();h&&("enabled"in h?h.enabled=!m:"legacyMode"in h&&(h.legacyMode=m)),te(L,{outputEncoding:l?3e3:3001,toneMapping:c?St:xt}),b.legacy!==m&&b.set(()=>({legacy:m})),b.linear!==l&&b.set(()=>({linear:l})),b.flat!==c&&b.set(()=>({flat:c})),o&&!z.fun(o)&&!at(o)&&!z.equ(o,L,ne)&&te(L,o),p&&!b.events.handlers&&b.set({events:p(f)});const T=vn(e,u);return z.equ(T,b.size,ne)||b.setSize(T.width,T.height,T.updateStyle,T.top,T.left),w&&b.viewport.dpr!==ot(w)&&b.setDpr(w),b.frameloop!==E&&b.setFrameloop(E),b.onPointerMissed||b.set({onPointerMissed:D}),j&&!z.equ(j,b.performance,ne)&&b.set(O=>({performance:{...O.performance,...j}})),v=M,s=!0,this},render(n){return s||this.configure(),ge.updateContainer(P.createElement(hn,{store:f,children:n,onCreated:v,rootElement:e}),_,null,()=>{}),f},unmount(){pt(e)}}}function hn({store:e,children:t,onCreated:r,rootElement:i}){return fe(()=>{const a=e.getState();a.set(f=>({internal:{...f.internal,active:!0}})),r&&r(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),P.createElement(lt.Provider,{value:e},t)}function pt(e,t){const r=se.get(e),i=r==null?void 0:r.fiber;if(i){const a=r==null?void 0:r.store.getState();a&&(a.internal.active=!1),ge.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var f,_,v,s;a.events.disconnect==null||a.events.disconnect(),(f=a.gl)==null||(_=f.renderLists)==null||_.dispose==null||_.dispose(),(v=a.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),tn(a),se.delete(e),t&&t(e)}catch{}},500)})}}ge.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:P.version});const Re={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function gn(e){const{handlePointer:t}=an(e);return{priority:1,enabled:!0,compute(r,i,a){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Re).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:a}=e.getState();(r=a.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:r=>{var i;const{set:a,events:f}=e.getState();f.disconnect==null||f.disconnect(),a(_=>({events:{..._.events,connected:r}})),Object.entries((i=f.handlers)!=null?i:[]).forEach(([_,v])=>{const[s,y]=Re[_];r.addEventListener(s,v,{passive:y})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([f,_])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Re[f];i.connected.removeEventListener(v,_)}}),r(f=>({events:{...f.events,connected:void 0}}))}}}}const yn=P.forwardRef(function({children:t,fallback:r,resize:i,style:a,gl:f,events:_=gn,eventSource:v,eventPrefix:s,shadows:y,linear:n,flat:o,legacy:u,orthographic:d,frameloop:p,dpr:M,performance:g,raycaster:l,camera:c,scene:m,onPointerMissed:C,onCreated:E,...w},j){P.useMemo(()=>Yt(zt),[]);const A=$t(),[R,D]=Bt({scroll:!0,debounce:{scroll:50,resize:0},...i}),b=P.useRef(null),L=P.useRef(null);P.useImperativeHandle(j,()=>b.current);const W=tt(C),[V,H]=P.useState(!1),[N,B]=P.useState(!1);if(V)throw V;if(N)throw N;const h=P.useRef(null);fe(()=>{const S=b.current;D.width>0&&D.height>0&&S&&(h.current||(h.current=mn(S)),h.current.configure({gl:f,events:_,shadows:y,linear:n,flat:o,legacy:u,orthographic:d,frameloop:p,dpr:M,performance:g,raycaster:l,camera:c,scene:m,size:D,onPointerMissed:(...T)=>W.current==null?void 0:W.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(v?Kt(v)?v.current:v:L.current),s&&T.setEvents({compute:(O,k)=>{const $=O[s+"X"],I=O[s+"Y"];k.pointer.set($/k.size.width*2-1,-(I/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),E==null||E(T)}}),h.current.render(P.createElement(A,null,P.createElement(nt,{set:B},P.createElement(P.Suspense,{fallback:P.createElement(Jt,{set:H})},t)))))}),P.useEffect(()=>{const S=b.current;if(S)return()=>pt(S)},[]);const x=v?"none":"auto";return P.createElement("div",ye({ref:L,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:x,...a}},w),P.createElement("div",{ref:R,style:{width:"100%",height:"100%"}},P.createElement("canvas",{ref:b,style:{display:"block"}},r)))}),zn=P.forwardRef(function(t,r){return P.createElement(Wt,null,P.createElement(yn,ye({},t,{ref:r})))}),de=new Z,Ie=new Z,bn=new Z;function wn(e,t,r){const i=de.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=r.width/2,f=r.height/2;return[i.x*a+a,-(i.y*f)+f]}function _n(e,t){const r=de.setFromMatrixPosition(e.matrixWorld),i=Ie.setFromMatrixPosition(t.matrixWorld),a=r.sub(i),f=t.getWorldDirection(bn);return a.angleTo(f)>Math.PI/2}function Pn(e,t,r,i){const a=de.setFromMatrixPosition(e.matrixWorld),f=a.clone();f.project(t),r.setFromCamera(f,t);const _=r.intersectObjects(i,!0);if(_.length){const v=_[0].distance;return a.distanceTo(r.ray.origin)<v}return!0}function En(e,t){if(t instanceof Ae)return t.zoom;if(t instanceof Le){const r=de.setFromMatrixPosition(e.matrixWorld),i=Ie.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,f=r.distanceTo(i);return 1/(2*Math.tan(a/2)*f)}else return 1}function Mn(e,t,r){if(t instanceof Le||t instanceof Ae){const i=de.setFromMatrixPosition(e.matrixWorld),a=Ie.setFromMatrixPosition(t.matrixWorld),f=i.distanceTo(a),_=(r[1]-r[0])/(t.far-t.near),v=r[1]-_*t.far;return Math.round(_*f+v)}}const ke=e=>Math.abs(e)<1e-10?0:e;function vt(e,t,r=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=ke(t[a]*e.elements[a])+(a!==15?",":")");return r+i}const Cn=(e=>t=>vt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Sn=(e=>(t,r)=>vt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function xn(e){return e&&typeof e=="object"&&"current"in e}const Hn=P.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:a,center:f,fullscreen:_,portal:v,distanceFactor:s,sprite:y=!1,transform:n=!1,occlude:o,onOcclude:u,castShadow:d,receiveShadow:p,material:M,geometry:g,zIndexRange:l=[16777271,0],calculatePosition:c=wn,as:m="div",wrapperClass:C,pointerEvents:E="auto",...w},j)=>{const{gl:A,camera:R,scene:D,size:b,raycaster:L,events:W,viewport:V}=Y(),[H]=P.useState(()=>document.createElement(m)),N=P.useRef(),B=P.useRef(null),h=P.useRef(0),x=P.useRef([0,0]),S=P.useRef(null),T=P.useRef(null),O=(v==null?void 0:v.current)||W.connected||A.domElement.parentNode,k=P.useRef(null),$=P.useRef(!1),I=P.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&xn(o[0]),[o]);P.useLayoutEffect(()=>{const q=A.domElement;o&&o==="blending"?(q.style.zIndex=`${Math.floor(l[0]/2)}`,q.style.position="absolute",q.style.pointerEvents="none"):(q.style.zIndex=null,q.style.position=null,q.style.pointerEvents=null)},[o]),P.useLayoutEffect(()=>{if(B.current){const q=N.current=qt(H);if(D.updateMatrixWorld(),n)H.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const F=c(B.current,R,b);H.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${F[0]}px,${F[1]}px,0);transform-origin:0 0;`}return O&&(a?O.prepend(H):O.appendChild(H)),()=>{O&&O.removeChild(H),q.unmount()}}},[O,n]),P.useLayoutEffect(()=>{C&&(H.className=C)},[C]);const G=P.useMemo(()=>n?{position:"absolute",top:0,left:0,width:b.width,height:b.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:f?"translate3d(-50%,-50%,0)":"none",..._&&{top:-b.height/2,left:-b.width/2,width:b.width,height:b.height},...r},[r,f,_,b,n]),U=P.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);P.useLayoutEffect(()=>{if($.current=!1,n){var q;(q=N.current)==null||q.render(P.createElement("div",{ref:S,style:G},P.createElement("div",{ref:T,style:U},P.createElement("div",{ref:j,className:i,style:r,children:e}))))}else{var F;(F=N.current)==null||F.render(P.createElement("div",{ref:j,style:G,className:i,children:e}))}});const ee=P.useRef(!0);ut(q=>{if(B.current){R.updateMatrixWorld(),B.current.updateWorldMatrix(!0,!1);const F=n?x.current:c(B.current,R,b);if(n||Math.abs(h.current-R.zoom)>t||Math.abs(x.current[0]-F[0])>t||Math.abs(x.current[1]-F[1])>t){const K=_n(B.current,R);let X=!1;I&&(Array.isArray(o)?X=o.map(J=>J.current):o!=="blending"&&(X=[D]));const ae=ee.current;if(X){const J=Pn(B.current,R,L,X);ee.current=J&&!K}else ee.current=!K;ae!==ee.current&&(u?u(!ee.current):H.style.display=ee.current?"block":"none");const pe=Math.floor(l[0]/2),mt=o?I?[l[0],pe]:[pe-1,0]:l;if(H.style.zIndex=`${Mn(B.current,R,mt)}`,n){const[J,ze]=[b.width/2,b.height/2],be=R.projectionMatrix.elements[5]*ze,{isOrthographicCamera:He,top:ht,left:gt,bottom:yt,right:bt}=R,wt=Cn(R.matrixWorldInverse),_t=He?`scale(${be})translate(${ke(-(bt+gt)/2)}px,${ke((ht+yt)/2)}px)`:`translateZ(${be}px)`;let Q=B.current.matrixWorld;y&&(Q=R.matrixWorldInverse.clone().transpose().copyPosition(Q).scale(B.current.scale),Q.elements[3]=Q.elements[7]=Q.elements[11]=0,Q.elements[15]=1),H.style.width=b.width+"px",H.style.height=b.height+"px",H.style.perspective=He?"":`${be}px`,S.current&&T.current&&(S.current.style.transform=`${_t}${wt}translate(${J}px,${ze}px)`,T.current.style.transform=Sn(Q,1/((s||10)/400)))}else{const J=s===void 0?1:En(B.current,R)*s;H.style.transform=`translate3d(${F[0]}px,${F[1]}px,0) scale(${J})`}x.current=F,h.current=R.zoom}}if(!I&&k.current&&!$.current)if(n){if(S.current){const F=S.current.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const{isOrthographicCamera:K}=R;if(K||g)w.scale&&(Array.isArray(w.scale)?w.scale instanceof Z?k.current.scale.copy(w.scale.clone().divideScalar(1)):k.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):k.current.scale.setScalar(1/w.scale));else{const X=(s||10)/400,ae=F.clientWidth*X,pe=F.clientHeight*X;k.current.scale.set(ae,pe,1)}$.current=!0}}}else{const F=H.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const K=1/V.factor,X=F.clientWidth*K,ae=F.clientHeight*K;k.current.scale.set(X,ae,1),$.current=!0}k.current.lookAt(q.camera.position)}});const Fe=P.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return P.createElement("group",ye({},w,{ref:B}),o&&!I&&P.createElement("mesh",{castShadow:d,receiveShadow:p,ref:k},g||P.createElement("planeGeometry",null),M||P.createElement("shaderMaterial",{side:Ht,vertexShader:Fe.vertexShader,fragmentShader:Fe.fragmentShader})))});let ue=0;const Bn=Ze(e=>(ve.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-ue)/(i-ue)*100})},ve.onLoad=()=>{e({active:!1})},ve.onError=t=>e(r=>({errors:[...r.errors,t]})),ve.onProgress=(t,r,i)=>{r===i&&(ue=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-ue)/(i-ue)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Wn=P.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:a=!0,keyEvents:f=!1,onChange:_,onStart:v,onEnd:s,...y},n)=>{const o=Y(w=>w.invalidate),u=Y(w=>w.camera),d=Y(w=>w.gl),p=Y(w=>w.events),M=Y(w=>w.setEvents),g=Y(w=>w.set),l=Y(w=>w.get),c=Y(w=>w.performance),m=t||u,C=i||p.connected||d.domElement,E=P.useMemo(()=>new Gt(m),[m]);return ut(()=>{E.enabled&&E.update()},-1),P.useEffect(()=>(f&&E.connect(f===!0?C:f),E.connect(C),()=>void E.dispose()),[f,C,r,E,o]),P.useEffect(()=>{const w=R=>{o(),r&&c.regress(),_&&_(R)},j=R=>{v&&v(R)},A=R=>{s&&s(R)};return E.addEventListener("change",w),E.addEventListener("start",j),E.addEventListener("end",A),()=>{E.removeEventListener("start",j),E.removeEventListener("end",A),E.removeEventListener("change",w)}},[_,v,s,E,o,M]),P.useEffect(()=>{if(e){const w=l().controls;return g({controls:E}),()=>g({controls:w})}},[e,E]),P.createElement("primitive",ye({ref:n,object:E,enableDamping:a},y))});export{zn as C,Hn as H,Wn as O,Bn as a,dt as u};
